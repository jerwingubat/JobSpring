<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer Dashboard | JobSpring</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="main.css">
    <style>
.btn-danger {
  background: #e53e3e !important;
  color: #fff !important;
  border: none;
}
.btn-danger:hover, .btn-danger:focus {
  background: #c53030 !important;
  color: #fff !important;
}
    .modal { position: fixed; z-index: 4000; left: 0; top: 0; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
    .modal-backdrop { position: absolute; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(44,62,80,0.25); }
    .modal-content { position: relative; background: #fff; border-radius: 16px; box-shadow: 0 8px 32px rgba(44,62,80,0.18); padding: 2.5rem 2rem; max-width: 700px; width: 98vw; z-index: 2; max-height: 90vh; overflow-y: auto; }
    @media (max-width: 600px) { .modal-content { padding: 1.2rem 0.5rem; } }
</style>
</head>
<body>
    <header>
        <div class="header-container container">
            <a href="index.html" class="logo">JobSpring</a>
            <nav>
                <ul id="mainNav">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="jobs.html">Jobs</a></li>
                    <li><a href="candidates.html">Candidates</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
            <button class="btn btn-outline" id="logoutBtn" style="margin-left:1.5rem;">Logout</button>
        </div>
    </header>
    <main class="container" style="padding: 3rem 0;">
        <div class="section-title">
            <h2>My Job Listings</h2>
            <p>Manage all jobs you have posted below.</p>
        </div>
        <button class="btn" id="addJobBtn" style="margin-bottom:2rem;">Add Job</button>
        <div id="jobModal" class="modal" style="display:none;">
          <div class="modal-backdrop" id="jobModalBackdrop"></div>
          <div class="modal-content" id="jobModalContent" tabindex="-1"></div>
          <button id="jobModalCloseBtn" aria-label="Close" style="position:absolute;top:18px;right:18px;z-index:10;background:none;border:none;font-size:1.7rem;color:#888;cursor:pointer;">&times;</button>
        </div>
        <div id="jobsContainer" class="jobs-container" style="max-width: 900px; margin: 0 auto;"></div>
        <p id="dashboardMsg" style="margin-top:1rem;text-align:center;"></p>
    </main>
    <footer>
        <div class="footer-grid container">
            <div class="footer-col">
                <h3>JobSpring</h3>
                <p>Empowering your career journey.</p>
            </div>
            <div class="footer-col">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="jobs.html">Jobs</a></li>
                    <li><a href="candidates.html">Candidates</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Contact</h3>
                <ul>
                    <li>Email: support@jobspring.com</li>
                    <li>Phone: +1 234 567 890</li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom container">
            <p>&copy; 2024 JobSpring. All rights reserved.</p>
        </div>
    </footer>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBYpGF5iy51Np9zbZH8Dzv5ZqV3dI-Lo9A",
      authDomain: "jobspring-15ced.firebaseapp.com",
      projectId: "jobspring-15ced",
      storageBucket: "jobspring-15ced.firebasestorage.app",
      messagingSenderId: "1055597236396",
      appId: "1:1055597236396:web:3edd2120f45c858947cf09",
      measurementId: "G-EFEEYJ1T94"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let currentUID = null;
    auth.onAuthStateChanged(async user => {
      if (!user) {
        window.location.href = "employer-login.html";
        return;
      }
      const userDoc = await db.collection('users').doc(user.uid).get();
      if (!userDoc.exists || userDoc.data().type !== 'employer') {
        window.location.href = "employer-login.html";
        return;
      }
      currentUID = user.uid;
      loadEmployerJobs();
    });
    let editingJobId = null;
    function showJobForm(job = null) {
      const modal = document.getElementById('jobModal');
      const content = document.getElementById('jobModalContent');
      modal.style.display = 'flex';
      editingJobId = job ? job.id : null;
      content.innerHTML = `
        <form id="jobForm" class="upload-box">
          <h2>${job ? 'Edit Job' : 'Add New Job'}</h2>
          <div class="form-group">
            <label for="job-title">Title</label>
            <input type="text" id="job-title" name="title" required value="${job ? job.title : ''}">
          </div>
          <div class="form-group">
            <label for="job-company">Company</label>
            <input type="text" id="job-company" name="company" required value="${job ? job.company : ''}">
          </div>
          <div class="form-group">
            <label for="job-type">Type</label>
            <input type="text" id="job-type" name="type" required value="${job ? job.type : ''}">
          </div>
          <div class="form-group">
            <label for="job-location">Location</label>
            <input type="text" id="job-location" name="location" required value="${job ? job.location : ''}">
          </div>
          <div class="form-group">
            <label for="job-salary">Salary</label>
            <input type="text" id="job-salary" name="salary" value="${job ? job.salary : ''}">
          </div>
          <div class="form-group">
            <label for="job-description">Description</label>
            <textarea id="job-description" name="description" required>${job ? job.description : ''}</textarea>
          </div>
          <button type="submit" class="btn" style="width:100%;margin-bottom:0.5rem;">${job ? 'Update Job' : 'Add Job'}</button>
          <button type="button" class="btn btn-outline" id="cancelJobBtn" style="width:100%;">Cancel</button>
        </form>
      `;
      // Focus modal for accessibility
      setTimeout(() => { content.focus(); }, 0);
      // Cancel button and backdrop close
      document.getElementById('cancelJobBtn').onclick = function() {
        modal.style.display = 'none';
        editingJobId = null;
      };
      // Backdrop and close button close
      document.getElementById('jobModalBackdrop').onclick = function(e) {
        if (e.target === this) {
          modal.style.display = 'none';
          editingJobId = null;
        }
      };
      document.getElementById('jobModalCloseBtn').onclick = function() {
        modal.style.display = 'none';
        editingJobId = null;
      };
      // Trap focus inside modal
      modal.onkeydown = function(e) {
        if (e.key === 'Tab') {
          const focusable = modal.querySelectorAll('input, textarea, button, [tabindex]:not([tabindex="-1"])');
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first) { e.preventDefault(); last.focus(); }
          } else {
            if (document.activeElement === last) { e.preventDefault(); first.focus(); }
          }
        } else if (e.key === 'Escape') {
          modal.style.display = 'none';
          editingJobId = null;
        }
      };
      document.getElementById('jobForm').onsubmit = async function(e) {
        e.preventDefault();
        const data = {
          title: document.getElementById('job-title').value,
          company: document.getElementById('job-company').value,
          type: document.getElementById('job-type').value,
          location: document.getElementById('job-location').value,
          salary: document.getElementById('job-salary').value,
          description: document.getElementById('job-description').value,
          employerId: currentUID,
          postedDate: job && job.postedDate ? job.postedDate : new Date().toLocaleDateString()
        };
        try {
          if (editingJobId) {
            await db.collection('jobs').doc(editingJobId).update(data);
            document.getElementById('dashboardMsg').textContent = 'Job updated successfully!';
          } else {
            await db.collection('jobs').add(data);
            document.getElementById('dashboardMsg').textContent = 'Job added successfully!';
          }
          document.getElementById('dashboardMsg').style.color = 'var(--success)';
          modal.style.display = 'none';
          editingJobId = null;
          loadEmployerJobs();
        } catch (err) {
          document.getElementById('dashboardMsg').textContent = err.message;
          document.getElementById('dashboardMsg').style.color = 'var(--danger)';
        }
      };
    }
    document.getElementById('addJobBtn').onclick = function() {
      showJobForm();
    };
    async function loadEmployerJobs() {
      const jobsContainer = document.getElementById('jobsContainer');
      jobsContainer.innerHTML = '<p>Loading your jobs...</p>';
      try {
        const snapshot = await db.collection('jobs').where('employerId', '==', currentUID).get();
        if (snapshot.empty) {
          jobsContainer.innerHTML = '<p>You have not posted any jobs yet.</p>';
          return;
        }
        let html = '';
        snapshot.forEach(doc => {
          const job = doc.data();
          job.id = doc.id;
          html += `
            <div class="job-card" style="margin-bottom:2rem;">
              <div class="job-header">
                <div>
                  <h3 class="job-title">${job.title}</h3>
                  <p class="job-company">${job.company || ''}</p>
                </div>
                <span class="job-type">${job.type || ''}</span>
              </div>
              <div class="job-details">
                <div class="job-detail"><i class="fas fa-map-marker-alt"></i> <span>${job.location || ''}</span></div>
                <div class="job-detail"><i class="fas fa-dollar-sign"></i> <span>${job.salary || ''}</span></div>
                <div class="job-detail"><i class="fas fa-clock"></i> <span>${job.postedDate || ''}</span></div>
              </div>
              <p class="job-description">${job.description || ''}</p>
              <div class="job-actions">
                <button class="btn btn-outline" onclick="editJob('${encodeURIComponent(JSON.stringify(job))}')">Edit</button>
                <button class="btn btn-danger" onclick="deleteJob('${doc.id}')">Delete</button>
              </div>
            </div>
          `;
        });
        jobsContainer.innerHTML = html;
      } catch (err) {
        jobsContainer.innerHTML = '<p>Error loading jobs: ' + err.message + '</p>';
      }
    }
    window.editJob = function(jobStr) {
      const job = JSON.parse(decodeURIComponent(jobStr));
      showJobForm(job);
    }
    window.deleteJob = async function(jobId) {
      if (!confirm('Are you sure you want to delete this job?')) return;
      try {
        await db.collection('jobs').doc(jobId).delete();
        document.getElementById('dashboardMsg').textContent = 'Job deleted successfully!';
        document.getElementById('dashboardMsg').style.color = 'var(--success)';
        loadEmployerJobs();
      } catch (err) {
        document.getElementById('dashboardMsg').textContent = err.message;
        document.getElementById('dashboardMsg').style.color = 'var(--danger)';
      }
    }
    document.getElementById('logoutBtn').addEventListener('click', function() {
      auth.signOut().then(() => {
        window.location.href = 'employer-login.html';
      });
    });
    </script>
</body>
</html> 